#######################
Using http API: ja-http
#######################

This document is targeted at software designers wishing to integrate SMS messaging as a function 
into their applications, e.g. in connection with WEB-server, unified messaging, information services etc.

Introduction
============
SMS Messages can be transmitted using HTTP protocol, the following requirements must be met to enable the service :

 * You need a Jasmin user account
 * You need sufficient credit on your Jasmin user account
 
Sending SMS-MT
==============

In order to deliver **SMS-MT** messages (**M**\obile **T**\erminated) Data is transferred using **HTTP GET/POST** requests.
The Jasmin gateway accepts requests at the following URL:

http://127.0.0.1:1401/send

.. note:: Host ``127.0.0.1`` and port ``1401`` are default values and configurable in ``/etc/jasmin/jasmin.cfg``.

HTTP Parameters
***************
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter name   | Value/Pattern                                                   | Example(s)                     | Presence  |Description                                                                                                                                                                             |
+==================+=================================================================+================================+===========+========================================================================================================================================================================================+
| to               | Msisdn with or without international prefix                     | +21620203060, 20203060         | Mandatory | Destination address, only one address is supported per request                                                                                                                         |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| from             | Msisdn with or without international prefix, alphanumeric value | +21620203060, 20203060, Jasmin | Optional  | Originating address, In case rewriting of the sender's address is supported/permitted by the SMSC used to transmit the message, this number is transmitted as the originating address. |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| username         | Text (30 char. max)                                             | jasmin_user                    | Mandatory | Username for Jasmin account.                                                                                                                                                           |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| password         | Text (30 char. max)                                             | jasmin_pass                    | Mandatory | Password for Jasmin account.                                                                                                                                                           |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| priority         | 1, 2 or 3                                                       | 2                              | Optional  | Default is 1 (lowest priority)                                                                                                                                                         |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| content          | Text                                                            | Hello world !                  | Mandatory | Content to be sent                                                                                                                                                                     |
+------------------+-----------------------------------------------------------------+--------------------------------+-----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Receiving SMS-MO
================

**SMS-MO** messages (**M**\obile **O**\riginated) are delivered as **HTTP GET/POST** from Jasmin's deliverSmThrower service to the destination http 
connector. 

The parameters below are transmitted for each SMS-MO, the receiving end must provide an url (set in **jasminApi.HttpConnector.baseurl**) and parse the
below parameters using GET or POST method (depends on **jasminApi.HttpConnector.method**).

The receiving end must reply back using a "**200 OK**" status header **and** a body containing an **acknowledgement** of receiving the SMS-MO, if one or both of
these conditions are not met, the deliverSmThrower service will consider reshipment of the same message if **config/deliversm-thrower/maxRetries** is not reached.

In order to acknowledge SMS-MO receipt, the receiving end must reply back with **exactly** the following html body content: **ACK/Jasmin**

.. note:: It is very important to acknowledge back each received SMS-MO, this will prevent to receive the same message many times.
.. note:: Reshipment of a message will be delayed for **config/deliversm-thrower/retryDelay** seconds.

HTTP Parameters
***************
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter name   | Value/Pattern                                                   | Example(s)                           | Presence  | Description                                                                                                                                                                                                                                                                    |
+==================+=================================================================+======================================+===========+================================================================================================================================================================================================================================================================================+
| id               | Universally Unique IDentifier (UUID)                            | 16fd2706-8baf-433b-82eb-8c7fada847da | Always    | Internal Jasmin's gateway message id                                                                                                                                                                                                                                           |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| from             | Msisdn with or without international prefix, alphanumeric value | +21620203060, 20203060, Jasmin       | Always    | Originating address.                                                                                                                                                                                                                                                           |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| to               | Msisdn with or without international prefix, alphanumeric value | +21620203060, 20203060, Jasmin       | Always    | Destination address, only one address is supported per request                                                                                                                                                                                                                 |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| origin-connector | Alphanumeric id                                                 | 23, bcd, MTN, clickatell, beepsend   | Always    | Jasmin http connector id                                                                                                                                                                                                                                                       |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| priority         | 1, 2 or 3                                                       | 2                                    | Optional  | Default is 1 (lowest priority                                                                                                                                                                                                                                                  |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| coding           | Numeric                                                         | 8                                    | Optional  | Default is 0 (SMSC_DEFAULT_ALPHABET), can be one of the followings: 1 (IA5_ASCII), 2 (OCTET_UNSPECIFIED), 3 (LATIN_1), 4 (OCTET_UNSPECIFIED_COMMON), 5 (JIS), 6 (CYRILLIC), 7 (ISO_8859_8), 8 (UCS2), 9 (PICTOGRAM), 10 (ISO_2022_JP), 13 (EXTENDED_KANJI_JIS), 14 (KS_C_5601) |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| validity         | YYYY-MM-DD hh:mm:ss                                             | 2013-07-16 00-46:54                  | Optional  | The validity period parameter indicates the Jasmin GW expiration time, after which the message should be discarded if not delivered to the destination.                                                                                                                        |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| content          | Text                                                            | Hello world !                        | Always    | Content of the message                                                                                                                                                                                                                                                         |
+------------------+-----------------------------------------------------------------+--------------------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

The flowchart below describes how message delivery is done inside deliverSmThrower service:

.. figure:: resources/sms-mo-flowchart.png
   :alt: MO delivery flowchart as processed by deliverSmThrower service
   :align: Center